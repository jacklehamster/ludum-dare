package  {	import flash.net.URLLoader;	import flash.net.URLRequest;	import flash.events.Event;		public class World {				static private const PAINTBRUSH_FAIL:String = "The color is fine as it is.";		static private const GUN_FAIL:String = "Let's not waste bullets on it.";		static private const FAIL:String = "I don't know what I'm doing.";				private var main:Main;		public function World(main:Main) {			this.main = main;		}				public function init():void {						blah();			return;			var urlloader:URLLoader = new URLLoader();			urlloader.addEventListener(Event.COMPLETE,onComplete);			urlloader.load(new URLRequest("dobukiworld.txt"));		}				private function onComplete(e:Event):void {			trace(e.currentTarget.data);			main.invisCell = 1;			main.grid.world = JSON.parse(e.currentTarget.data);						main.mainCharacter = "Dok";			if(!main.grid.getById(main.mainCharacter))				command(null,"create",'{"id":"'+main.mainCharacter+'","name":"Dok","className":"Dok","character":1,"team":1,"icon":[28,65,.8,.8],"speed":0.07}',{x:-6,y:9});						main.centerCharacter();		}				function blah():void {			command(null,"create",'{"type":"floor","image":"woodtile.png"}',{x:-3,y:7});			command(null,"create",'{"type":"floor","image":"metaltile.png"}',{x:-2,y:7});			command(null,"create",'{"type":"floor","image":"metaltile.png"}',{x:-4,y:7});			command(null,"create",'{"type":"floor","image":"metaltile.png"}',{x:-3,y:6});			command(null,"create",'{"type":"floor","image":"metaltile.png"}',{x:-3,y:8});			command(null,"create",'{"type":"floor","image":"metaltile.png"}',{x:-2,y:6});			command(null,"create",'{"type":"floor","image":"metaltile.png"}',{x:-4,y:8});			command(null,"create",'{"type":"floor","image":"metaltile.png"}',{x:-2,y:8});			command(null,"create",'{"type":"floor","image":"metaltile.png"}',{x:-4,y:6});			command(null,"create",'{"type":"lwall","image":"brickwall.png"}',{x:-3,y:7});			command(null,"create",'{"type":"rwall","image":"brickwall.png"}',{x:-3,y:7});			command(null,"create",'{"type":"lwall","image":"glasswall.png"}',{x:-2,y:6});			command(null,"create",'{"type":"lwall","image":"glasswall.png"}',{x:-3,y:6});			command(null,"create",'{"hotspot":{"x":0,"y":-0.5},"range":1,"type":"lwall","object":"door","className":"Door","interact":"open"}',{x:-4,y:6});			command(null,"create",'{"type":"lwall","image":"glasswall.png"}',{x:-5,y:6});			command(null,"create",'{"type":"lwall","image":"glasswall.png"}',{x:-1,y:6});			command(null,"create",'{"type":"lwall","image":"glasswall.png"}',{x:0,y:6});			command(null,"create",'{"type":"lwall","image":"glasswall.png","interact":"take","snap":1,"object":"wall"}',{x:1,y:6});//			command(null,"create",'{"type":"lwall","image":"glasswall.png"}',{x:1,y:6});			command(null,"create",'{"type":"rwall","image":"glasswall.png"}',{x:-4,y:7});			command(null,"create",'{"object":"paintbrush","interact":"take","scale":0.2,"image":"paint.png"}',{x:-7,y:7});//			command(null,"create",'{"object":"gun","range":3,"interact":"take","scale":0.5,"image":"lasergun.png"}',{x:-7,y:8});			command(null,"create",'{"className":"Table","dimension":"3x2","block":1}',{x:0,y:7});			command(null,"create",'{"image":"banana.png","interact":"take","useName":"eat","object":"banana","scale":0.5}',{x:-4.5,y:6.5});			command(null,"create",'{"shortAnswer":"hello!","object":"Pikachu","className":"Pikachu","interact":"sit","hotspot":{"x":-0.2,"y":0.2},"lock":{"key":"041524d8c19e4168a1e98cc1c71fb920","properties":{"swf":["Pika.swf",null]}}}',{x:-3,y:8});			command(null,"create",'{"type":"rwall","image":"glasswall.png"}',{x:3,y:6});			command(null,"create",'{"type":"rwall","image":"glasswall.png"}',{x:3,y:7});			command(null,"create",'{"type":"rwall","image":"glasswall.png"}',{x:3,y:8});			command(null,"create",'{"type":"rwall","image":"glasswall.png"}',{x:3,y:9});			command(null,"create",'{"type":"rwall","image":"glasswall.png"}',{x:3,y:10});			command(null,"create",'{"type":"lwall","image":"glasswall.png"}',{x:2,y:6});			command(null,"create",'{"type":"lwall","image":"glasswall.png"}',{x:3,y:6});//			command(null,"create",'{"className":"Pikachu","interact":"test","hotspot":{"x":-0.2,"y":0.2}}',{x:-5,y:8});			command(null,"create",'{"object":"plant","file":"plant.swf","className":"Plant","interact":"take","hotspot":{"x":-0.2,"y":0.2}}',{x:-5,y:8});			command(null,"create",'{"type":"floor","image":"metaltile.png","destination":{"map":"world.txt","location":"entrance"}}',{x:-4,y:5});			command(null,"create",'{"object":"dragon","file":"dragonroom.swf","className":"Dragon","interact":"talk","hotspot":{"x":-0.2,"y":0.2}}',{x:-3,y:10});			//			command(null,"setBackground","dragonroom.swf");			command(null,"create",'{"id":"Wanda","name":"Wanda","className":"Wanda","character":1,"team":1,"icon":[28,85,1,1]}',{x:-6,y:9});			command(null,"create",'{"id":"Zomba","name":"Zomba","className":"Zomba","character":1,"follow":"Wanda","team":1,"icon":[28,85,1,1]}',{x:-6,y:8});		}		function command(characterID:String,activity:String,subjectID:String=null,spot:Object=null):Object {			return main.command(characterID,activity,subjectID,spot);		}				public function handleInteraction(action:String,subject:Object):void {			switch(action) {				case "talk":					handleTalk(subject);					break;			}			trace(action + " >>>",JSON.stringify(subject));		}		private function handleTalk(subject:Object):void {			if(subject.shortAnswer) {				command(subject.id,"say",subject.shortAnswer);			}			else {				switch(subject.object) {					default:				}			}		}				public function handle(... items:Array):Boolean {			var combo:Array = [];			for(var i:int=0;i<items.length;i++)				combo[i] = items[i].object;			combo.sort();			trace(combo.join("+"));			switch(combo.join("+")) {				case "banana":					command(main.mainCharacter,"say","Delicious!");					main.destroyObjects(items[0]);					break;				case "gun+paintbrush":					command(main.mainCharacter,"say","Test");					break;				default:					handleFailedCombo(items);					return false;			}			return true;		}		private function handleFailedCombo(array:Array):void {			if(array.indexOf("paintbrush")>=0) {				command(main.mainCharacter,"say",PAINTBRUSH_FAIL);			}			else if(array.indexOf("gun")>=0) {				command(main.mainCharacter,"say",GUN_FAIL);			}			else {				command(main.mainCharacter,"say",FAIL);			}		}	}	}